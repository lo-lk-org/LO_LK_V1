<!--
 - @author Shivaraj <mrshivaraj123@gmail.com> Nov_20_2014
 - @tutorial Sample file
 - -->
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">

<link rel="import" href="../bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="../bower_components/core-icon/core-icon.html">
<link rel="import" href="../bower_components/core-icons/core-icons.html">

<link rel="import" href="../bower_components/polymer-ui-card/polymer-ui-card.html">

<link rel="import" href="../bower_components/paper-fab/paper-fab.html">

<link rel="import" href="../bower_components/font-roboto/roboto.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog-transition.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">

<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">

<link rel="import" href="../bower_components/ajax-form/ajax-form.html">
<link rel="stylesheet" href="../bower_components/ajax-form/demo_resources/alertify.core.css" />
<link rel="stylesheet" href="../bower_components/ajax-form/demo_resources/alertify.default.css" />
<script src="../bower_components/ajax-form/demo_resources/alertify.min.js"></script>

<polymer-element name="money-list" attributes="uid"><!--noscript-->

<template>
    <link rel="stylesheet" href="css/money-list.css">
    
    <div id="container">
	<h3>Expense list</h3>
	
	<!--
	Show Money List
	--->
	<!--//action=read&module=money&content_style=list_content&uid=105890155775932582508&tff=2014-11-15&tft=2014-12-09&q=&limit=10&page=&category_id=&group_id=-->
	<!--{"total_rows":17,"pages":2,"start_row":0,"current_page":1,"next_page":2,"money":[{"sno":1,"money_id":"22","uid":"105890155775932582508","lat":"4455.596","long":"1476.7893"
	    ,"visibility":"pub","money_title":"Shopping","money_amount":"3000","item_unit_price":"3000","item_units":"Rs"
	    ,"item_qty":"1","total_price":"3000","money_flow_direction":"0","file_id":"0","category_id":"5","modified_on":null,"timestamp":"2014-12-07 02:55:17","group_id":"1","time_string":"this_week"},{"sno":2,"money_id":"21","uid":"105890155775932582508","lat":"4455.596","long":"1476.7893","visibility":"pub","money_title":"Rent","money_amount":"6000","item_unit_price":"6000","item_units":"Rs","item_qty":"1","total_price":"6000","money_flow_direction":"0","file_id":"0","category_id":"5","modified_on":null,"timestamp":"2014-12-08 22:55:17","group_id":"1","time_string":"yesterday"},{"sno":3,"money_id":"20","uid":"105890155775932582508","lat":"17.4466519","long":"78.3906701","visibility":"pub","money_title":"shivaraj","money_amount":"500","item_unit_price":"30","item_units":"pc","item_qty":"6","total_price":"180","money_flow_direction":"1","file_id":"0","category_id":"2","modified_on":null,"timestamp":"2014-12-08 00:00:00","group_id":"0","time_string":"yesterday"},{"sno":4,"money_id":"19","uid":"105890155775932582508","lat":"17.4466806","long":"78.390669","visibility":"pub","money_title":"uday","money_amount":"1000","item_unit_price":"30","item_units":"pc","item_qty":"6","total_price":"180","money_flow_direction":"0","file_id":"0","category_id":"2","modified_on":null,"timestamp":"2014-12-03 00:00:00","group_id":"7","time_string":"this_week"},{"sno":5,"money_id":"17","uid":"105890155775932582508","lat":"17.4467406","long":"78.3906874","visibility":"pub","money_title":"uday","money_amount":"500","item_unit_price":"30","item_units":"pc","item_qty":"6","total_price":"180","money_flow_direction":"0","file_id":"0","category_id":"2","modified_on":null,"timestamp":"2014-11-29 00:00:00","group_id":"7","time_string":"this_quarter"},{"sno":6,"money_id":"16","uid":"105890155775932582508","lat":"17.446767","long":"78.3907064","visibility":"pub","money_title":"hi","money_amount":"500","item_unit_price":"30","item_units":"pc","item_qty":"6","total_price":"180","money_flow_direction":"1","file_id":"0","category_id":"2","modified_on":null,"timestamp":"2014-11-23 00:00:00","group_id":"0","time_string":"this_quarter"},{"sno":7,"money_id":"15","uid":"105890155775932582508","lat":"17.4467566","long":"78.3906908","visibility":"pub","money_title":"hres","money_amount":"500","item_unit_price":"30","item_units":"pc","item_qty":"6","total_price":"180","money_flow_direction":"1","file_id":"0","category_id":"0","modified_on":null,"timestamp":"2014-11-22 00:00:00","group_id":"0","time_string":"this_quarter"},{"sno":8,"money_id":"14","uid":"105890155775932582508","lat":"17.4467402","long":"78.3907055","visibility":"pub","money_title":"uday","money_amount":"800","item_unit_price":"30","item_units":"pc","item_qty":"6","total_price":"180","money_flow_direction":"0","file_id":"0","category_id":"0","modified_on":null,"timestamp":"2014-11-22 00:00:00","group_id":"0","time_string":"this_quarter"},{"sno":9,"money_id":"13","uid":"105890155775932582508","lat":"17.4466869","long":"78.3907073","visibility":"pub","money_title":"tgdd","money_amount":"568","item_unit_price":"30","item_units":"pc","item_qty":"6","total_price":"180","money_flow_direction":"0","file_id":"0","category_id":"0","modified_on":null,"timestamp":"2014-11-22 00:00:00","group_id":"0","time_string":"this_quarter"},{"sno":10,"money_id":"11","uid":"105890155775932582508","lat":"17.4467189","long":"78.3906952","visibility":"pub","money_title":"fgfg","money_amount":"800","item_unit_price":"30","item_units":"pc","item_qty":"6","total_price":"180","money_flow_direction":"1","file_id":"0","category_id":"0","modified_on":null,"timestamp":"2014-11-20 00:00:00","group_id":"0","time_string":"this_quarter"}]}-->
	
	<core-ajax url="../api/" auto response="{{moneylist}}" 
	    params='{"action":"read","module":"money","content_style":"list_content","uid":"4523623456456456aaaaaa","tff":"","tft":"","q":"","limit":10,"page":0,"category_id":"","group_id":""}' method="POST" handleAs="json">
	</core-ajax>
	
	<template if="{{moneylist.status=='success'}}">
	    <div>Showing {{moneylist.num_rows}} items out of {{moneylist.total_rows}}.</div>

	    <div id="cards">
		<template repeat="{{g in moneylist.money}}">
		    <polymer-ui-card swipeable>
			<!--<paper-fab mini icon="favorite" class="right"></paper-fab>-->
			<h4>{{g.money_title}}</h4>
			<div>Rs. {{g.money_amount}}</div>
			<br>
			    <div><small>Created On {{g.timestamp}}</small></div>
			<br>
			<paper-fab mini icon="remove" right></paper-fab>
			<paper-fab mini icon="create" right></paper-fab>
		    </polymer-ui-card>
		</template>
	    </div>
	</template>
	
	<template if="{{moneylist.next_page}}">
	    <a href="/lyfekit-polymer/{{moneylist.next_page}}">Next</a>
	</template>
	
	<template if="{{moneylist.status=='error'}}">
	    <p>{{moneylist.response}}</p>
	</template>

	 <!--Money Add form--> 
	 <!--transition="paper-dialog-transition-bottom"-->
	<paper-dialog heading="Add Money Item" transition="paper-dialog-transition-bottom"  autoCloseDisabled="true" heading="Expense Manage List" backdrop="true">
	    
	    <h1 id="pleaseWait" class="hidden">Sending your data...</h1>
	    
	    <form is="ajax-form" action="api_handler" method="post" id="money-add-form">
                <div>
                    <label>Full Name: <input type="text" name="name" required></label>
                </div>
                
                <div>
                    <label>Address: <input type="text" name="address" required></label>
                </div>
                
                <div>
                    <label>Favorite color: <input type="text" name="color"></label>
                </div>
    
                <div>
                    <b>Receive periodic email updates from us?</b>
                    <input type="radio" name="emailCommunication" value="yes" checked>yes
                    <input type="radio" name="emailCommunication" value="no">no
                </div>

                <input type="submit">
            </form>
	    
	    <!--<form is="ajax-form" method="post" enctype="multipart/form-data" action="" width="100%" id="money-form">
		<paper-input label="Title" name="expense_title" value="" required></paper-input>
		<!--<section>-->
		    <!--<table class="" cellpadding="4" width="100%">-->
<!--			<tr>
			    <th><lable>Expense Title</lable></th>
			    <td><paper-input label="Title" name="expense_title" value="" required></paper-input>
				<input type="hidden" name="nativeHidden" value="12345" />
				<paper-input floatinglabel multiline label="Description" name="description"></paper-input>
			    </td>
			</tr>-->
<!--			<tr>
			    <th><lable>Expense Amount</lable></th>
			    <td><paper-input label="Amount" name="expense_amount" value="" required></paper-input></td>
			</tr>
			<tr>
			    <th><lable>Money Direction</lable></th>
			    <td>
				<paper-dropdown-menu valign="bottom" valueattr="label" name="Money Flow" label="Money Flow" selected="In" required>
					<paper-item label="In" value="In">In</paper-item>
					<paper-item label="Out" value="Out">Out</paper-item>
				</paper-dropdown-menu>
				<select><option value="1">In</option><option value="0">Out</option></select>
			    </td>
			</tr>
			<tr>
			    <th></th>
			    <td>
				<paper-button type="submit" autofocus >Add Item1</paper-button>
				<input type="submit" id="add_item_btn" value="Add Item" />
			    </td>
			</tr>
		    </table>-->
		<!--</section>-->
	    <!--</form>-->
	    
	    <div id="notify_block"></div>
	    <paper-button dismissive>Close</paper-button>
	    <paper-button type="submit" affirmative autofocus>Add Item</paper-button>
    	    <!--<paper-button label="More Info..." dismissive></paper-button><paper-button label="Add" affirmative autofocus></paper-button>-->

	    <polymer-element name="money-form" extends="form" on-submit="{{ prepareSubmit }}" on-click="{{ handleClick444 }}">
		<script>
		    (function() {
			var form = document.getElementById('money-add-form'); //document.getElementsByTagName('form')[0],
			var content = document.getElementById('notify_block');

			form.addEventListener('invalid', function() {
			    alertify.error('Some form fields are invalid!');
			});

			form.addEventListener('submitting', function(event) {
			    document.getElementById('pleaseWait').className = '';
			    content.className = 'hidden';
			    event.detail.raytest = 'foobar';
			    event.detail.color = 'blue';
			});

			form.addEventListener('submitted', function(event) {
			    document.getElementById('pleaseWait').className = 'hidden';
			    content.className = '';

			    if (event.detail.status > 299) {
				alertify.error('Submission failed!  Please try again.')
			    }
			    else {
				content.innerHTML = 'Thanks!  Your choices have been submitted!';
			    }
			});
		    }());

		    /*Polymer('ajax-form', {
			ready: function(event, detail, sender) {
			    console.log("In Ready");
			    var form=this;
			    form.addEventListener('submitting',
				function(event) {
				    var formData = event.detail.formData;
				    // optionally modify formData...
				    
				    console.log(formData);
				}
			    );
			}
			,handleClick: function(event, detail, sender) {
			    console.log("Handle click");
			    if (event.target.localName.indexOf('-') !== -1 && event.target.getAttribute('type') === 'submit') {
				this.prepareSubmit();
				console.log(this);
				return false;
				//this.submit();
			    }
			}*/
			/*,prepareSubmit: function(event, detail, sender) {
			    console.log("SUBMITTING...");
			    event.preventDefault();
			
			console.log(event);
//			console.log(detail);
//			console.log(sender);
			
				var form = detail.formData;
				console.log(form);
				console.log("Length="+form.children);
				Array.prototype.forEach.call(form.children, function(child) {
				    var name = child.getAttribute('name');

				    console.log("Name="+name);
				    if ('value' in child && child.type !== 'submit' && name) {
				      console.log(name, child.value);
				      // Use jQuery.ajax or a Polymer/core-ajax element to send
				      // the data to the server
				    }
				});

			
//				      Array.prototype.forEach.call(this.children, function(child) {
//					var name = child.getAttribute('name');
//		
//					// Add <input type="hidden">s for all custom elements with a name and value besides submit buttons
//					if (child.localName.indexOf('-') !== -1 && name && 'value' in child && child.getAttribute('type') !== 'submit') {
//					  element = document.createElement('input');
//					  element.setAttribute('type', 'hidden');
//					  element.setAttribute('name', name);
//					  element.setAttribute('value', child.value);
//					  this.appendChild(element);
//					}
//				      }.bind(this));
			    return false;
			}
		    });*/
		</script>
	      </polymer-element>
	    
	</paper-dialog>

	    <div class="fab red">
	      <core-icon icon="add"></core-icon>
	      <paper-ripple class="circle recenteringTouch" fit left on-click="{{toggleDialog}}"></paper-ripple>
	    </div>
<!--	    <div class="fab green">
	      <core-icon icon="create"></core-icon>
	      <paper-ripple class="circle recenteringTouch" fit></paper-ripple>
	    </div>-->
<!--	    <paper-button label="Transition A" onclick="toggleDialog('paper-dialog-transition-bottom')"></paper-button>
	    <paper-button label="Transition B" onclick="toggleDialog('paper-dialog-transition-center')"></paper-button>
	    <paper-button label="Transition c" on-click="{{toggleDialog}}"></paper-button>-->
    </div>
</template>
    
    <script>
	
	Polymer('money-list',{
	    ready : function(){
		this.next_page=0;
		this.uid="4523623456456456";
		
//		document.addEventListener('polymer-ready', function() {
		    document.querySelector('#cards').addEventListener(
			'polymer-card-swipe-away', function(e) {
			    e.target.parentNode.removeChild(e.target);
		    });
//		});

	    }
	    ,toggleDialog: function(e, detail, sender) {
		//var story = e.target.templateInstance.model.s;
		var transition = 'paper-dialog-transition-bottom';//paper-dialog-transition-center
//		console.log(e);
//		console.log(detail);
//		console.log(e.detail.label);
//		console.log(sender);
//		console.log(transition);
		var dialog = this.$.container.querySelector('paper-dialog[transition=' + transition + ']');
//		console.log(dialog);
		dialog.toggle();
		   		   
		//console.log("Clicked " + story.headline);
		//this.loadStory(story.id); // accessing non-rendered data from the model
	    }
	    
	    //,params:'{"action":"read","module":"money","content_style":"list_content","uid":{{'+uid+'}},"tff":"","tft":"","q":"","limit":10,"page":0,"category_id":"","group_id":""}'
//	    document.querySelector('#cards').addEventListener(
//		'polymer-card-swipe-away', function(e) {
//	      e.target.parentNode.removeChild(e.target);
//	    });
	});
	
//	  function toggleDialog(transition) {
//	       var dialog = document.querySelector('paper-dialog[transition=' + transition + ']');
//	       console.log(dialog);
//	       //dialog.toggle();
//	   }
    </script>

</polymer-element>